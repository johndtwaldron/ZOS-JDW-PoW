
00:00:01
hello my name is David Ware I'm going to be talking to you about IBM mq's publish Subscribe Feature it's a general introduction it's going to cover all the various concepts of publish subscribe specifically with respect to mq we're going to look at how you administer it how you manage it we'll have a look at how you create subscriptions and how you publish and then finally we're going to touch on how you set up mq topologies to do polish subscribe across multiple key managers so let's start off with what is publish subscribe if you're familiar with mq you're almost definitely familiar with point to point so that's the ability to be able to Define cues and have producers put messages onto that queue you put a message onto the queue and they'll build up and they can then be consumed at a later date so a message consumer can come along it can get a message from a queue receive a message from our queue when it receives that message it's removed from the queue and no one else will see that message


00:01:08
different consumers come along they will see different messages so it's one message comes in one message goes out Pub subscribe is a little different we have a number of the same Concepts we've got message producers and consumers we've got an additional concept of a subscription which we'll talk about more as we go through but for now we just need to understand that a subscription is a way of matching messages being produced to interested consumers and to be able to cue those messages up so each subscription is associated with a queue so in that case it's not that different from point to point when you produce a message instead of opening a queue directly or even a subscription directly you publish a message to a topic when you've created your subscriptions you also associate those subscriptions with a topic as well and it's that matching of those topics that matches messages from The Producers


00:02:11
through to the consumers we'll talk about topics more as we go through so we have a message producer who's going to be publishing some messages to a topic publishes a message to a topic and then it's mq's responsibility to work out which subscriptions are also interested in that topic and take that one message and deliver a copy to each of them so that's where it differs from point to point here we've published one message and we've ended up with three copies of the message which means for our three different consumers they each will consume a copy of that message rather than one copy that came out in the first example and obviously you can send more messages and they'll go via the subscriptions to their cues and onto the consumers and just as for point to point if the consumers aren't keeping up with the publication traffic those messages can build up on the queues and be processed at a later time and we'll talk much more about different subscriptions different ways of consuming when we get later into this


00:03:17
particular presentation so that's the delivery of the messages what about matching those messages to topics conceptually you have these topics which identify the subject that the message is being published on and they identify what the subscriptions are interested in and you can have many different patterns of these so for example we've got Publishers on green topics and subscribers to Green as well in that situation just as before we've got three subscriptions that match it so we get three copies of a message being distributed to those three subscriptions equally you could have multiple Publishers on the same topic like you have here for orange and even a single subscription you have a single subscription when you publish just one copy of the message goes to it which is very similar to point to point interestingly if you look at the blue publisher there are no blue subscribers now if you


00:04:20
have no subscribers when you publish the message that message doesn't match anything and that message will just disappear it's not a failure it's not an error this is the publish subscribe model you deliver the messages to the matching subscribers if there aren't any matching subscribers the message doesn't go anywhere so that's a key differentiator between publish subscribe and point to point let's have a very quick look at the history of published subscribing mq just to make it clear in case you've got a um a knowledge of previous versions of mq right back um early on in mq we supported publish subscribe we supported it with something called a support pack which was effectively an external published subscriber broker on the side of a queue manager the queue manager itself didn't understand publish subscribe and around about the same time IBM integration Buffs or message broker as it was back then also supported publicly subscribing a similar model


00:05:25
then in mq version 7 we drove all that published subscribe logic right inside mq right inside to the queue managers themselves so at this point Q managers became aware of all the fundamental concepts of published subscribe so they can more efficiently and better support the publish subscribe messaging model and then obviously since then we've progressed that with further releases of mq also over that time the apis but you can use publish subscribe with have changed right back at the um at the origin of public subscriber with mq the only way of doing it was using command messages these were messages with special mq headers on the front saying what you were publishing or subscribing to and you'd put them onto special mqqs JMS came along soon after and XMS it's dot net um cousin came along soon after that these supported publish subscribe in their apis in a similar way to point to point so they didn't expose any of the command message format that was all hidden


00:06:29
inside the JMS layer simplifying the way you did public subscribe then when version 7 came along we extended the native mqi support so that's mq's own API where you open queues and you put and get messages here that was extended in version 7 to allow you to subscribe to topics and also to open topics so that you could publish on them again so you didn't need to have a command message format let's talk more about topics because topics are a fundamental part of publish subscribing mq and key to your understanding it's all about a thing called a topic tree a topic tree exists in every queue manager and it's how the publish subscribe engine works so we're going to be using an example as we go through this entire presentation we're going to be doing it on fruit and vegetables specifically the


00:07:30
price of fruit and vegetables so let's start off with a price of an apple so how would I publish or subscribe to that well most important thing to understand is this thing called a topic string topic string is the human readable way of doing publish subscribe it's the thing that you can understand um is the the matching up between Publishers and subscribers mq doesn't understand that string it doesn't have to have any configuration that maps to it as we'll see as we go through but there's one or two characters that are specific um to mq which does help it um handle it at runtime and in the administration so the main one is the forward slash so we've got slash price slash fruit slash apples this is telling mq but there's actually three parts to this topic string the price the fruit and the apples part and


00:08:30
it's going to use those to dynamically build itself its topic tree so when it first hears about the price fruit Apple's topic string it'll extend the topic Tree in this queue manager to support it so we always start off with an empty tree with the root of the tree the blank topic string being represented and then we will add the nodes to allow us to support that particular topic string so we end up with a slash price node a slash price fruit node and then finally the slash price slash fruit slash apples node now if more topic strings come along which fall into the same pattern of these nodes in the topic tree we can just extend that tree so the price of oranges we just need one extra node to support price fruit oranges and then price of vegetables we need two extra nodes the vegetables node and the potatoes node so this topic tree I'll say again is dynamically being built as and when it is needed


00:09:32
so how do we have how do we use this tree why do we have this tree there's a couple of reasons one is at runtime it allows us to efficiently match up between Publishers and subscribers when a subscription comes along and here we've drawn the subscription the same way as we did before apart from here now it's mapping a topic string onto a queue so we've got a subscription to price fruit oranges and we find the correct node in the tree or create it if it doesn't already exist and we attach the subscription to it as more subscriptions come along we attach them to the correct place in the tree too when a publisher comes along it needs to open the topic string and say what it's going to be publishing on so this publisher says it's going to be publishing on price fruit oranges at which point we can also attach it to the right place in the topic tree because they're now attached to the same node when that publisher comes to publish it can very efficiently just deliver a copy of the message to each of those subscriptions


00:10:35
this is also a good point to introduce the concept of wild card topic strings Wild Card topic strings are used by subscriptions where there are other special characters in a topic string that indicate that it isn't a single topic string you're interested in it's actually a pattern of topic strings that you want to match against so the obvious character is the hash character so we've got slash price slash fruit slash hash that means this subscription wants to see any Publications on anything starting price slash fruit so we identify that in a tree we identify all the nodes that it could match against and now again if you were to publish on price root oranges this time we'd also automatically deliver a copy to the subscription for a price fruit hash so this is how we efficiently get messages from the Publishers to the subscribers so that's sort of introducing the topic tree concept so what's a good way of Designing a topic


00:11:39
tree well there's a couple of aspects that you should be aware of to make sure that you start off with a good tree first off make it extendable what does that mean as well a topic tree is used for the whole queue manager so all applications doing publish subscribed on their key manager share the same topic tree so if you have different applications using different sets of topic strings to do publish subscribe you probably don't want them to interfere with each other so for example if they both happen to use the same underlying topic string you would start to get Publications and being delivered from one application into a different application which you might not be wanting to do so you need to be able to separate them out so make sure that even if you start off with a single application but topic strings are clear in what they are used for possibly with a high level delimiter saying this is being used for a particular application that allows you to extend it in the future and saying it's these this topic tree is


00:12:43
used for a single queue manager actually if you join multiple key managers together as we'll see later on in topologies then parts of a topic tree become Global across all of those queue managers at which point you really want to make sure that topic tree makes sense across your entire mq network other aspects to be aware of is the fact that because we are dynamically creating these nodes in a topic tree you can without even knowing it the continually extending the topic tree every time you publish you might be publishing on a unique topic string or a topic string that hasn't been used for a long time in which case the queue manager will create the nodes representing that particular topic string and it'll do that on the Fly before it uses it to publish so if you're continually publishing to different unique topic strings it has to continually create new topic nodes as well as creating those topping nodes it's also detecting topic nodes that haven't been used for a while and automatically cleaning them up a bit


00:13:46
like garbage collection it does this because otherwise we would be continually creating new nodes and not releasing them which means we would eventually use too much resource of your system so we continue trying to keep on top of the size of a topic tree all this Dynamic nature means the queue managers having to do work so if you're rapidly publishing on new topic strings that extra work will be happening on the key manager and you should take that into account when you're designing your system because if you're doing this too much of this rapid generation of the topic nodes that might cause you performance problems in the future other aspects when we're talking about Dynamic trees the actual shape of a tree if for example you had a point in your topic tree where suddenly you had many many thousands of topic nodes hanging off that particular point in the tree so for example you had a user ID or


00:14:50
an account reference at one point in neutral on your tree you could have tens or hundreds of thousands of those nodes hanging from a single point if you do that you might put undue stress on that particular point in the tree so it's better to try and separate out those into smaller subtrees also when you have a dynamic tree if you have many many extra layers in your topic tree that you isn't really providing um use in that you're not subscribing to them specifically or you're not using them for wild cards or matching then consider not having extra levels in your tree because if you put extra levels in your tree using forward slashes mq will have to generate those extra nodes every time it learns about a new topic string so again these are things to consider if your tree is dynamically changing all the time let's talk about configuration because we haven't touched on configuration yet because everything so far has been dynamic


00:15:55
introduce the concept of topic objects topic objects are defined pieces of administration a bit like when you define a queue or you define a channel in a queue manager and they allow you to configure different parts of the tree in different ways so you can have different applications using different branches of a tree and behaving independently from each other however if you don't need that you don't need to configure extra topic objects so when you first create your queue manager you get a single topic object defined which relates to the entire tree it has a name as all objects in mq do and there it's a 48 character name restricted to the various you know restricted character set that mq provides and it's called system.base.topic with the topic object you associate it with a particular point in the topic tree so this base topic lives at the very top of the tree


00:16:56
and therefore you specify a topic string of blank like I said this is a default object so it's provided every time you create a key manager with only that defined any node that is generated underneath it in the topic tree which is every single topic node will behave based on that topic attributed above because it inherits Its Behavior from atopic objects defined in that tree if you want to separate out different branches to behave differently you can introduce new topic objects so you define yourself a topic object you give it a name and then you associate it with a particular point in the tree by specifying the topic string that matches that point so here we've got fruit obs on the topic string of Slash price fruit and we've got veg job on slash price vegetables this gives us the capability of being able to say anyone publishing or subscribing to the price of apples oranges or bananas or anything will behave differently to those publishing or subscribing to any


00:18:01
of the vegetables so let's look a little bit more detail of how you do this so this is a slice out of that same tree the price fruit oranges branch we've got our system based Topic at the top and I've pulled out a couple of the attributes of a of that topic object there's about a couple of dozen attributes on that object um which subtly change the behavior of Publishers and subscribers the two I've picked out are Pub and default persist now Pub is saying a bit like put on a queue are we allowing anyone to publish messages to this branch of a topic tree death persist is the default persistence that's saying if I am publishing and I don't specify it's a persistent or a non-persistent message should it be by default a non-persistent message or a persistent message so these are just standard attributes that you have on the top of your object similar to ones that you have in point to point as we've only got the system-based topic


00:19:05
defined at this point in time all the nodes will inherit their behavior from it so if I was to publish on price fruit oranges I would behave based on the system based topic but if I Define the topic object we saw in a previous Slide the fruit object and I put it on the slash price fruit node I can set individual attributes on it just like with any other mq object you only have to set the ones you're interested in and leave the rest to pick up their default values so here we're just setting the default persistence to be yes which is different to the system based topics value everything else is left of the defaults and the defaults for topic objects are typically this as parent value as parent means this object isn't explicitly setting the value instead leave it up to the objects that are defined above it in the topic tree so let's see how that works in practice we come along and we want to publish on price fruit oranges we need to know how this publisher is going to behave so first of all what message persistence to use


00:20:12
so because on the price fruit oranges node it's a dynamic node and doesn't have any configuration it doesn't know the answer to that so it has to walk up a tree so it has to go and look at the node above where we do have the configuration and the default persistence has been set to yes so that's the value but we're going to use for the price fruit oranges node because it's the closest object defined on this branch of the tree if we want to see if Publications are enabled or not so that's the pub attribute we do exactly the same we go up to the node above we see if it's defined it now we do have the object defined but the attribute has been set to as parent which means actually it's not specifically defined for this node so keep moving up the tree and we move up the tree until we find another topic object with an actual value set in this case it's been Pub enabled which means that's the value we're going to use so here you can see the system based topic is controlling the pub value for everything


00:21:14
imagery and the fruit object is defining the persistence value for everything in its sub-branch of the tree so it builds up this compound set of attributes Security on topics Works in a similar way so you need to be able to say who can publish and who can subscribe to which topic strings in a tree instead of granting access to specific topic strings what you need is you need to Define topic objects place them in the tree at the correct points and then Grant access to those topic objects when you grant a access to the objects you do it in a very similar way that you would to a queue so you can use set mq award or set off Rec um to specify which users have access to this object and what um what role they can do so you can say can they publish can they subscribe for example so say we wanted to have some users access have access to subscribe to price fruit


00:22:20
and some to price fruit veg sorry price vegetables here we will Define our two objects that we saw before and we would Grant individually authority to those different objects so we've given Bob access to the fruit side and Jane access to the vegetable side now when a subscription comes along to price fruit apples say from Bob we're going to do like we did for the attributes we're going to walk up a tree find a topic object and from there we're going to work out whether that user has is allowed to do what they're trying to do in this case subscribe so if we go up to the fruit object we see if Bob can subscribe in this case he can so we allow the subscription in if Jane comes along and tries to subscribe to price fruit apples even though she's been granted access to the vegetable side there's nothing on the fruit side so we walk up to the fruit object has Jane got access no she hasn't now at


00:23:21
that point we don't say sorry Jane you can't subscribe We Carry On up a tree we're carrying up the tree to the next topic object and we see if at that point she's been granted access if she had been granted access at that point we would allow her to subscribe to price fruit apples but she hasn't and because that's the very top of the tree we've now run out of places to look so at that point we say you don't have access so we prevent the subscription so you can tell from here the higher up the tree you grant someone access the more they can actually do but more of the tree they can publish or subscribe to and if you grant someone access to the system based topic I either very very top of a tree you're effectively saying you can publish or subscribe to anything anywhere on this tree there's no restrictions because nothing you do below it on any of the objects will prevent that user from being able to publish subscribe so bear that in mind when you're


00:24:25
granting access very high up inventory so let's look at these topics that we've been talking about how do you manage them so as you can probably expect you can look at the topic objects we've just been talking about similar way to display cues you do display topic put in asterisk and you get back all the topics the topic objects so we've got fruit of veg jobs and we've got a system based topic and a bunch of other system defined topics that are used for various reasons if you pick on a particular one and look at it you'll see all of its attributes and here you can see the fruit object where we've set the topic string to price fruit we also set default resistance to yes and everything else is defaulted to as parent or various other attributes so like Pub which we were looking at earlier that's set to as parent so that's exactly as we configured it not particularly interesting and again


00:25:28
mq explorer that can do exactly the same you can just look at the various attributes so that sort of standard practice for administering objects in mq it's a bit more interesting to actually look at a topic tree itself so how do you do that well first thing you can do is you can see how big your tree is so in version 8 we added the ability to be able to see how many nodes there are in your topic tree that's a useful thing to be able to do because if you're in a dynamic environment where topic nodes are dynamically being created you want to make sure that that topic tree isn't just growing over time because you're continually creating new ones or you're creating them faster than mq can delete them so if you look at the count periodically hopefully that will stay a steady number but to look at the individual nodes you use display TP status and here instead of using the typical asterisk that you use in run MKC to say


00:26:30
I want to look at lots of different entries you use the topic string wildcard notation so here we're looking at hash which says show me all of the topic nodes I've limited it down to only the topic nodes where there are subscribers attached so we've gone where sub count is greater than zero because one of the attributes you get on a topic node is how many subscribers are currently attached which is the sub count then if we look at an individual topic node we zoom in on that it looks a bit different for when you look at an administer topic object it has similar things it has the topic string we're at Price fruit apples at this point but for all the other values it shows you the resolved value it doesn't show you the configured value so default persistence that's yes because it's picking that up from the fruit object and Pub is set to enable because it's picking that up from a system based topic so this is showing you exactly how a publisher or


00:27:30
subscriber would behave when using this particular node in the topic tree again you can see the same in mq Explorer actually it's a little bit nicer you could say because if you look at a topic and look at the status on it you can start to drill down into the various nodes in the topic tree and work your way to the point you want in that particular tree rather than having to list them all or progressively go through the individual nodes let's talk about how applications interact with publish subscribe so when you're creating a subscription or you're publishing I've talked about topic strings and I've talked about topic objects so which of the applications you use well there's a choice they can use for topic string or they can use a topic object or they can actually use both of them so why would you use for different ones and what does it mean to use them so the topic string that's probably the easiest one to use it's the closest thing to to what you're


00:28:33
probably thinking of when you're designing your application or writing your application because it's the human readable topic string so in this sort of pseudo code we're not providing a topic object but we are providing a topic string that being the case it's the topic string exactly as it's written is what we use when we subscribe and the same would be true if we were publishing alternatively we could provide the topic object if we provide a topic object and not a topic string we take the topic object we find its configuration we find the topic string is associated with I have a point in the tree whether it was configured and that's the topic string but we subscribe to or publish to so we actually go into the tree at the point where that topic object is defined so you might want to do that instead of a topic string if you don't want to expose your entire topic tree to a particular application but it does require you to create the topic objects there's a sort of combination method as


00:29:36
well where you can specify a topic object and you specify a topic string here what you're doing is the topic object is the first part of the string to be used it then has a slash added to it and then we take the topic string you provide and we append that to the end so here we've got fruit opt which maps to slash price fruit we put an extra slash in and then we've got apples as the topic strings so we tack that on the end so we get price fruit apples this can lead to consum some confusion where we've seen people provide a topic object that identifies the topic string they want to use and then they specify the topic string as well if you do that you're going to get it repeated you're going to get it double on that topic or when uh within the topic string so we would have price fruit apples price fruit apples for example one way of diagnosing that is to go and look at your topic tree like we saw a minute ago go and look at the individual nodes if you see some Curious nodes with curious names then perhaps it's for that


00:30:40
reason or look where you've got subscribers attached using the sub count there you can actually match up to see whether the subscribers are on the same node as the publishers let's talk a bit more about subscriptions there are different types of subscriptions we've got how you create them um the lifetime of the subscription the underlying parts for cue that's used for the subscription that I mentioned earlier all of these aspects um can be used in conjunction with the other aspects so they all relate to each other in some ways I'm going to try and represent that in the next few slides first off how do you create a subscription well there's two ways you can do it programmatically so in your application you can say create me a subscription that might be using jms's Create durable subscription it might be using the mqi and saying mq sub and then specifying create on it the map would dynamically create your subscription you don't need to do any configuration for that alternatively you can administratively


00:31:43
Define your subscription so you can go into run mpsc or mq Explorer you can go Define sub and create yourself a subscription in both cases you end up with a subscription they're pretty much the same the behavior when we're delivering messages to them are the same the behavior of applications being able to consume from them being able to attach to them is the same so it really comes down to how you want to set up your system in the first place as to how you create your subscriptions subscription lifetime subscription lifetime relates to when you create your subscription how do you delete the subscription or when does it disappear you've got durable and non-gerable subscriptions so these are Concepts that should be familiar to you if you're familiar with JMS durable subscriptions mean you create the subscription and then you have to explicitly delete it and until you've explicitly deleted it it will remain in the system so you can create it in one application and then disconnect that application and


00:32:44
the subscription will continue to exist and it'll stay there and it will stay keep receiving Publications that match to it even when no application is connected and then when an application reconnects it'll be able to process the messages that delivered while it wasn't attached from the queue that underpins that particular subscription so that's durable ones non-jurable ones the ones where you create it you have to do it within an application it doesn't make sense to do it administratively you do it within an application and it's tied to the lifetime of a connection under which you created when the connection disappears the subscription is automatically cleaned up the Subscribe any messages on the queue for the subscription are deleted mq is deleted as well that's if it's a managed queue as we'll see in a second but basically the subscription itself is removed from the system so here if your application creates a non-dual subscription and then disconnects and reconnects no messages that were published in that period when it wasn't connected will be delivered to that particular subscription


00:33:51
finally we've got the queue management underpinning the subscription I talked right from the start of how subscriptions are really a mapping between topic strings and queues because that's where we deliver the messages to but if you're a simple published subscribe application you might not want to worry about the underlying queue you might not even care but it exists or not if that's the case we have managed subscription cues where when you create the subscription mq will automatically create you a queue associated with a subscription and that's where messages will be delivered to it when you delete the subscription it'll automatically delete messages and delete the queue as well so that's a managed subscription queue alternatively if you want more control over your environment you might want to use an unmanaged subscription queue so this is where you create a queue a new associate with subscription with that specific queue that gives you more control but obviously more to consider more to worry about so that leads me on to how do you access


00:34:53
the messages off of subscriptions queue you can do it via the subscription so this is where you create yourself a subscription you've Associated a queue with it probably maybe a managed queue because you don't really care what Q what the queue is or it could be an unmanaged one it's your choice but when you want to access messages from it you open the subscription you open the subscription and start consuming messages from it you don't even need to know that the queue exists under the covers you definitely don't need to know the name of a queue or anything like that so you just automatically start consuming the messages from the subscription itself that's a sort of true or simple publish subscribe application it doesn't even know but point to point or queuing is happening under the covers it does have some limitations so for example it has to behave like a subscribing application so only one application is connect can access a subscription at any one time which means you can't have multiple consuming applications on the go for a single


00:35:56
subscription there are ways of getting around that JMS for example has support for shared subscriptions now in JMS 2.0 or or clone subscriptions prior to that in mq working in this way using the subscription opening the subscription is sort of generally you get generally better feedback because you're telling mq what you're doing you're opening the subscription and using the subscription itself so you get you can see more things if you go and look at the subscriptions you'll see when you last opened it for example alternatively you could go in via the queue so in this situation you would need to use an unmanaged queue because you need to know the queue itself a managed queue is really owned by mq and you shouldn't be accessing it directly but if you create a subscription with an unmanaged queue that's going to be how messages get delivered to the queue but now you've got this queue and you can just access it like a normal point-to-point application would so you can open the


00:36:56
queue directly and start receiving messages so that opens up the possibility that you can do things like you can have multiple consuming applications all attached to that queue concurrently and consuming the messages you can also do things like have multiple different subscriptions for different topic strings all pointing to the same queue so that you can aggregate messages coming in into one place where a consuming application can consume them from so you get more control but as you can see you lose some of the feedback into the mq system so for example you're sort of mixing point-to-point applications with published subscribe applications so let's look at how you manage the subscriptions themselves you can go into your admin tool so run mqc here and you can display all the subscriptions when you do this you don't just get the administered subscriptions but ones you've administratively created you also


00:37:57
get any of the programmatically created ones as well so you just see them all listed here and you can dive into any one of them look at all of its attributes or you can look at its status where you see things like when it was last access and if you want to look in and see whether messages are queued up on a particular subscription you need to pick out the name of the destination from a subscription definition and then you use that as you would normally for another queue display the queue have a look at it that way so you can get to all the component parts of a subscription this in this way as well as doing it through Nokia C you can obviously do the same through mq Explorer right let's let's briefly talk about publishing publishing is very like just putting messages to a queue you just open a topic or a topic or a topic string or a topic object as we talked about and then you put messages to it or send messages to it there are however a couple of subtleties that I'll describe


00:39:02
the first one is about feedback in the event of failures if we consider point to point to start with it's quite nice and simple if I try and put a message onto a queue and I fail I'll get feedback I'll be told that it failed but if I succeed and say it's a persistent message under a transaction I know that the messages got on there and it will be reliable it will be recoverable in the event of any failures and the same for when I consume messages if I get a message if I consume a message and I get an okay back from that I know the message is gone so that's nice and clear-cut publish subscribe is a little bit more complicated before I get into the complexities first thing I'll say is if you're using persistent messages you're publishing persistent messages under transactions and that succeeds and gets messages onto the subscription queues we'll talk about the subtleties of a subscription used in just a second but if it gets a message onto them they are just as reliable as onto actual point-to-point cues so if you have a failure and you restart the system


00:40:06
those messages will be recovered and replaced and put back onto the subscription cues obviously these need to be durable subscriptions for this to take effect because non-drivable ones would disappear in the event of a failure so persistent messages to durable subscriptions just as recoverable as persistent messages to standard queues but the real subtlety is about did the message get onto the subscription queue if you consider the situation where we're publishing messages we've got four matching subscriptions and we fail to get the message onto one of those subscription cues the question is does the publisher know that this happened do the other subscriptions receive their copy of a message if we uh follow the publish subscribe rules then technically a publisher shouldn't know anything about the subscriptions nothing a subscription does should affect a publisher and definitely nothing one subscription does should affect other subscriptions so if that was to be the case


00:41:12
you shouldn't see that failure you shouldn't get any feedback to say that anything has happened but this is mq and we realize that if you're doing specifically persistent messaging you want to have that reassurance that this has worked you want to know that your messages have successfully entered the system or failed to enter the system and you can take action against it so the default Behavior is if you're publishing persistent messages to durable subscriptions and we fail to deliver a message to one of those durable subscriptions we will fail the publication completely we will not deliver it to any of the other subscriptions and we will send an error back to the publisher you can individually control this so you can say actually that's not Behavior I want I just want you to work with no errors being fed back or you could say actually for non-persistent messages I also want that level of feedback and you


00:42:12
can do that using other attributes on atopic objects which is the persistent and non-persistent message delivery options another subtlety to be aware of is if you have a dead letter queue defined and we can't deliver a message to a subscription queue we will automatically try and deliver it to the dead letter queue for that queue manager if we succeed to deliver it to the day letter queue we're going to treat that now as a success and if that one succeeded and all we ever succeeded everything now looks like a good publication even though one copy of a message didn't get to a subscription queue instead ended up on a dead letter q so that can be confusing because some people are only expecting messages for the say coming off channels to go onto the dead letter queue in version 7.1 we added an attribute to topics of used dlq so you can now individually define whether to use the dead letter q or not in these error situations so that's


00:43:15
something to consider last thing I'll say here is something I said on one of the very very early slides which was if there were no subscriptions here and we were publishing messages even if they were persistent transacted messages but there were no matching subscriptions that publication would succeed it's not an error to publish when there aren't any matching subscriptions you don't get that feedback nothing has failed here so bear that in mind you're not going to know if there are no subscriptions there in the system there are subtle ways that you can in some apis find that information out but it's not really within the spirit of publish subscribe foreign thing I'll talk about for publishing is a concept called retained Publications so what's the scenario here well say we've got a subscriber to the price of oranges and we've got a publisher who is periodically publishing that price every time it publishes that subscription gets an update so that's good it's always up to date with the latest price of oranges but if


00:44:21
a new subscription comes along it's going to have to wait for that publisher to republish for price before it knows what the price of the Orange is so it has that period where it no it doesn't know anything it's got to wait for the next publication which could be seconds minutes hours days later so what happens if that subscription wants to know immediately the price of oranges this is where we use retained Publications so we're back to how we were publishing on the price of oranges and we've got a subscription that subscription still receives those Publications but if you publish and say retain the publication it tells the queue manager to also keep a copy of the message back in the queue manager for that particular topic string every time you publish it overwrites the previous one with the last message published on that particular topic string


00:45:23
this doesn't change any of the behavior of the existing subscription but if a new subscription comes along rather than having to wait for the next publication our oranges to occur it will immediately be delivered a copy of that publication that was retained on this queue manager so now it instantly knows the price of oranges and can go about its business it doesn't have to wait for the next publication there are a couple of subtleties with this one thing to consider is the queue manager is now storing all of this information if you're doing this across tens or uh hundreds of thousands of different topic strings vacuum manager has to retain this information now that starts to look an awful lot like a database mq is not a database mq doesn't give you the tooling for databases don't give you the support for databases it's really a messaging system so take that into account if you're using retained Publications another thing to point out is don't


00:46:26
confuse this with persistent Publications I was talking a minute ago about sending persistent Publications and then being recoverable you can do that completely independently of retained you don't have to retain your Publications as well as make them persistent if all you want to make sure of is that if your system goes down when your system comes back up again your durable subscriptions still have the same Publications that they had waiting to be processed at the time that it went down that just needs persistent Publications it doesn't need a retaining of them so finally I'm going to talk about topologies now topologies relate to doing publish subscribe across multiple key managers or distributed publish subscribe we've looked at doing Publishers subscribe in a single queue manager where the Publishers and the subscribers are all connected to the same queue manager and we use the local topic tree to match the Publications to the subscriptions and deliver it to their cues


00:47:27
in a distributed publish subscribe model you might have your Publishers and your subscribers on different queue managers in your system from here you want to be able to publish on one key manager and no matter where the subscriptions are you want to deliver them a copy of the publication you really want to do that without the applications realizing that they are separated you also really want to do that without the administrator having to individually root messages between certain queue managers whether Publishers and the subscribers are and that's where mq provides you with a couple of topologies that allow you to do this so first off we've got hierarchies hierarchy is a way of manually defining a relationship between different queue managers so that we can root messages between them we've also got mq clusters you might be familiar with mq clusters from a point to point um situation where you deliver messages to different queues in the cluster where it's a Federation of queue managers that


00:48:28
automatically can learn about different queue managers you can also use that in the published subscribe world to get messages from Publishers to matching subscriptions so for a hierarchy the messages flow via the immediate relationships so with the publisher here separated from the different subscriptions any Publications would first flow up to that top queue manager and then down to the correct key managers with the subscriptions so you're flowing it between the direct relationships not going between the Publishers and immediately to the subscribers cluster has a different a cup two different routing policies first of all it's got a direct mechanism so this is the one that was available in mq version 7 and continues to be available today which is where any message is published from one queue manager will go directly to the queue manager where any subscriptions are and then processed so that's the direct routing


00:49:33
in version 8 we've added an alternative mechanism this allows you to specify where you want messages to be rooted via so when we're publishing here we're going to root them via that middle queue manager when we publish a message it goes to that middle queue manager and then that distributes it on to where the individual subscriptions are so there are different reasons why you might pick one or the other of these mechanisms of these topologies and that can be based on a number of different aspects it can be your size of your system the style of your messaging the style of your your subscribers so there's many different things that can influence which one of these you pick I'm not going to go into that here I'll do another presentation where we talk about the individual aspects of that so that brings me to the end hopefully that's given you a good rounded understanding of the various aspects of publish subscribe in IBM mq thank you for listening foreign

